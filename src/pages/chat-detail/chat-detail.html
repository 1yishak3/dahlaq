<ion-header>
  <ion-navbar>
    <ion-buttons start>
      <button ion-button (tap)="cancel()" clear>
        <ion-icon color="light" (tap)="cancel()" name="close"></ion-icon>
      </button>
    </ion-buttons>
    <ion-title>
      <ion-buttons>
        <button ion-button icon-only clear (click)="openPerson()">
          {{oUser}}
          <ion-icon name="egg" color="secondary" *ngIf="online.on"></ion-icon>
          <ion-note *ngIf="!online.on" >Last seen {{online.time | momentjs}}</ion-note>
        </button>
      </ion-buttons>
      <!-- <ion-buttons end>
        <button ion-button icon-only><ion-icon *ngIf="connected" name=""></ion-icon><ion-icon *ngIf="!connected"name=""></ion-icon></button>
      </ion-buttons> -->
    </ion-title>
  </ion-navbar>

    <div *ngIf="connected&&show" style="background:green;color:white;text-align:center">You are connected!</div>
    <div *ngIf="!connected" style="background:red;color:white;text-align:center">No internet connection</div>
</ion-header>


<ion-content style="background:black">
  <input type="file" #fileInput style="height: 0px;width:0px" accept="image/*"name="files[]" (change)="onChangeInput($event)" />

  <ion-fab top left>
    <button (click)="presentConfirm()" *ngIf="spoken" ion-fab mini><ion-icon name="trash-a"></ion-icon></button>
  </ion-fab>

  <div *ngIf="ready">
    <div class="talk-bubble tri-right round left-top" *ngIf="typing">
      ...
    </div>
    <span *ngFor="let message of messages;let i =index">
      <div class="talk-bubble round" *ngIf="message.sender===oUser&&(message.time>messages[i-1].time-60000&&message.time<messages[i-1].time+60000)">
        <ion-row>
          <img *ngIf="message.picture!==''" [src]="message.picture"/>

          <div [innerHtml]="message.content|linky"></div>
        </ion-row>
        <ion-row>
          <ion-col col-3>
            {{message.time|momentjs}}
          </ion-col>
        </ion-row>
      </div>
      <div class="talk-bubble tri-right round left-top" *ngIf="message.sender===oUser&&(message.time<messages[i-1].time-60000||message.time>messages[i-1].time+60000)">
        <ion-row>
            <img *ngIf="message.picture!==''" [src]="message.picture"/>
          <div [innerHtml]="message.content|linky"></div>
        </ion-row>
        <ion-row>
          <ion-col col-3>
            {{message.time|momentjs}}
          </ion-col>
        </ion-row>
      </div>
      <div class="talk-bubble round" *ngIf="message.sender===user&&(message.time>messages[i-1].time-60000&&message.time<messages[i-1].time+60000)">
        <ion-row>
            <img *ngIf="message.picture!==''" [src]="message.picture"/>
          <div [innerHtml]="message.content|linky"></div>
        </ion-row>
        <ion-row>
          <ion-col col-11>
            {{message.time|momentjs}}
          </ion-col>
          <ion-col col-1>
            <ion-icon color="light" name="checkmark" *ngIf="message.sent&&!message.read"></ion-icon>
            <ion-icon color="primary" name="checkmark" *ngIf="message.read"></ion-icon>
          </ion-col>
        </ion-row>
      </div>
      <div class="talk-bubble tri-right round right-top" *ngIf="message.sender===user&&(message.time<messages[i-1].time-60000||message.time>messages[i-1].time+60000)">
        <ion-row>
            <img *ngIf="message.picture!==''" [src]="message.picture"/>
          <div [innerHtml]="message.content|linky"></div>
        </ion-row>
        <ion-row>
          <ion-col col-11>
            {{message.time|momentjs}}
          </ion-col>
          <ion-col col-1>
            <ion-icon color="light" name="checkmark" *ngIf="message.sent&&!message.read"></ion-icon>
            <ion-icon color="primary" name="checkmark" *ngIf="message.read"></ion-icon>
          </ion-col>
        </ion-row>
      </div>
    </span>
  </div>
  <ion-footer style="background:transparent">
    <!--ion-row style="background:#1a1a1a;">
      <ion-col>
        <ion-textarea #textt id="textarea" block [(ngModel)]="message" autosize style="width:275px;background:#1a1a1a;color:grey;overflow:scroll;max-height:100px; min-height:25px" placeholder="Message"></ion-textarea>
      </ion-col>
      <ion-col>
        <ion-buttons end>
          <button ion-button clear><ion-icon color="light" style="font-size:25px;" name="send"></ion-icon></button>
        </ion-buttons>
      </ion-col>
    </ion-row-->
    <ion-row>
    <ion-col text-center col-2>
      <ion-spinner *ngIf="uploading"color="light"></ion-spinner>
      <ion-icon *ngIf="complete" color="primary" name="checkmark"></ion-icon>
    </ion-col>
    <ion-col text-center col-10>
      <div>{{currentFile}}</div>
    </ion-col>
  </ion-row>
    <ion-grid style="background:#1a1a1a">
      <ion-row *ngIf="spoken" wrap>
        <ion-col col-2>
          <div>
            <button ion-button
            clear icon-only
    (click)="toggled = !toggled"
    [(emojiPickerIf)]="toggled"
    [emojiPickerDirection]="'bottom' || 'top' || 'left' || 'right'"
    (emojiPickerSelect)="handleEmoji($event)">
              <ion-icon color="light" style="position:relative;top:0px;font-size:20px;" name="happy"></ion-icon>
            </button>
            <button ion-button clear icon-only (click)="showChoices()">
              <ion-icon color="light" style="position:relative;top:0px;font-size:20px;" name="camera"></ion-icon>
            </button>


          </div>
        </ion-col>
        <ion-col col-9>
          <ion-textarea item-content #textt id="textarea" block (change)="subscribe()" [(formControl)]="messageCtrl" [(ngModel)]="message" autosize
          style="background:#1a1a1a;color:white;overflow:auto;max-height:100px;" placeholder="Message">
          </ion-textarea>
        </ion-col>
        <!--get an attache icon here that is clickable-->
        <ion-col col-1>
          <button (click)="sendMessage()"  ion-button clear icon-only>
            <ion-icon color="light" style="font-size:25px;" name="send"></ion-icon>
          </button>
        </ion-col>
      </ion-row>
      <div *ngIf="!spoken" padding>
      <button ion-button color="secondary" (click)="habeshaHi()" block>Send a #habeshaHI!</button>
      </div>
    </ion-grid>

  </ion-footer>
</ion-content>
